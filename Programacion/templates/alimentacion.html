<!DOCTYPE html>
<html lang="es" data-theme="default">
<head>
  <meta charset="UTF-8">
  <title>Alimentación - VytalGym</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- IMPORTANTE: Incluir el sistema de temas global -->
  {% include 'partials/tema_global.html' %}
  
  <link rel="stylesheet" href="{{ url_for('static', filename='css/pagina.css') }}">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,500,700" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <script src="{{ url_for('static', filename='js/script.js') }}" defer></script>

  <style>
    /* Estilos específicos con variables CSS */
    body {
      font-family: 'Roboto', sans-serif;
      background: linear-gradient(180deg, var(--gradient-start) 0%, var(--gradient-middle) 40%, var(--gradient-end) 100%);
      color: var(--text-color);
      scroll-behavior: smooth;
    }
    
    .titulo-seccion {
      background-color: var(--header-bg);
      color: var(--text-color);
      padding: 1.5rem 2rem;
      margin-top: 80px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      margin-bottom: 40px;
    }
    
    .titulo-seccion h1 {
      color: var(--primary-color);
    }
    
    .main-content {
      padding: 20px 40px;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .macro-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }
    
    .macro-card {
      background: var(--card-bg);
      color: var(--text-color);
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
      text-align: center;
    }
    
    .macro-card h3 {
      color: var(--primary-color);
      margin-top: 0;
    }
    
    .recipes-section {
      background: var(--card-bg);
      color: var(--text-color);
      border-radius: 8px;
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
    }
    
    .recipes-section h2 {
      color: var(--primary-color);
      margin-top: 0;
    }
    
    .recipe-list {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    
    .recipe-card {
      display: flex;
      gap: 20px;
      background: #f7f9fa;
      border-radius: 8px;
      overflow: hidden;
    }
    
    .recipe-card img {
      width: 120px;
      height: 120px;
      object-fit: cover;
    }
    
    .recipe-card div {
      padding: 15px 15px 15px 0;
    }
    
    .recipe-card h3 {
      margin: 0 0 10px 0;
      color: var(--text-color);
    }
    
    .recipe-card p {
      margin: 0;
      color: #666;
    }
    
    #google-calendar-container {
      background: var(--card-bg);
      color: var(--text-color);
      border-radius: 8px;
      padding: 30px;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
    }
    
    #google-calendar-container h2 {
      color: var(--primary-color);
      margin-top: 0;
    }
    
    #events-list {
      list-style: none;
      padding: 0;
    }
    
    #events-list li {
      background: #f7f9fa;
      margin-bottom: 10px;
      padding: 15px;
      border-radius: 6px;
      border: 1px solid #e0e0e0;
    }
    
    #events-list li strong {
      color: var(--text-color);
    }
    
    #events-list li button {
      background: var(--secondary-color);
      color: var(--text-color);
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 10px;
    }
    
    button, .btn {
      background-color: var(--secondary-color);
      color: var(--text-color);
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    
    button:hover, .btn:hover {
      background-color: var(--primary-color);
    }
    
    /* Responsive Styles */
    @media (max-width: 768px) {
      .main-content {
        padding: 0 20px 20px;
      }
      
      .recipe-card {
        flex-direction: column;
      }
      
      .recipe-card img {
        width: 100%;
        height: 180px;
      }
      
      .recipe-card div {
        padding: 15px;
      }
    }
  </style>
</head>
<body>
  {% include 'partials/header.html' %}

<!-- CONTENIDO PRINCIPAL -->
<div class="titulo-seccion">
  <h1>Zona Alimentación</h1>
  <p>Organiza tus menús, aprende sobre nutrición y recibe recomendaciones personalizadas.</p>
</div>
<div class="main-content">
  <!-- HERO BANNER y tarjetas de macronutrientes -->
  <div class="macro-cards">
    <div class="macro-card">
      <h3>Proteínas</h3>
      <p>Base para la construcción de músculo y regeneración de tejidos. Prioriza fuentes magras.</p>
    </div>
    <div class="macro-card">
      <h3>Carbohidratos</h3>
      <p>La principal fuente de energía. Incluye cereales integrales y frutas en tu dieta.</p>
    </div>
    <div class="macro-card">
      <h3>Grasas</h3>
      <p>Esenciales para funciones hormonales. Elige grasas saludables como aguacate o aceite de oliva.</p>
    </div>
  </div>

  <!-- Sección de recetas -->
  <div class="recipes-section">
    <h2><i class="fas fa-utensils"></i> Recetas Destacadas</h2>
    <div class="recipe-list">
      <div class="recipe-card">
        <img src="https://picsum.photos/600/400?random=500" alt="Receta 1">
        <div>
          <h3>Ensalada</h3>
          <p>Hojas verdes, pollo a la plancha y frutos secos. Perfecta para un almuerzo ligero.</p>
        </div>
      </div>
      <div class="recipe-card">
        <img src="https://picsum.photos/600/400?random=501" alt="Receta 2">
        <div>
          <h3>Smoothie de Proteína</h3>
          <p>Combina frutas, leche vegetal y tu proteína favorita para un desayuno rápido.</p>
        </div>
      </div>
      <div class="recipe-card">
        <img src="https://picsum.photos/600/400?random=502" alt="Receta 3">
        <div>
          <h3>Salteado de Verduras</h3>
          <p>Brócoli, zanahoria y pimientos con salsa ligera. Alto en vitaminas.</p>
        </div>
      </div>
    </div>
  </div>

  <p style="line-height:1.6; margin-bottom:30px;">
    Ajusta tus comidas según tus objetivos y deja que nuestra IA te sugiera planes semanales equilibrados. Explora más recetas y tips para convertir tu alimentación en un pilar de tu salud.
  </p>

  <div id="google-calendar-container">
    <h2>Mis Eventos de Google Calendar</h2>
    <ul id="events-list">
      <li>Cargando eventos...</li>
    </ul>
  </div>
</div>

<script>
function loadCalendarEvents() {
    const eventsList = document.getElementById('events-list');
    eventsList.innerHTML = '<li>Cargando eventos...</li>';

    fetch('/api/calendar/events')
        .then(response => {
            console.log('Respuesta del servidor:', response.status); // Debug
            return response.json();
        })
        .then(data => {
            console.log('Datos recibidos:', data); // Debug
            if (data.status === "error") {
                eventsList.innerHTML = `<li>Error: ${data.message}</li>`;
                // Si necesita autorización, mostrar botón
                const authButton = document.createElement('button');
                authButton.textContent = 'Conectar con Google Calendar';
                authButton.onclick = () => window.location.href = '/autorizar';
                eventsList.appendChild(authButton);
                return;
            }

            eventsList.innerHTML = '';
            if (data.events && data.events.length > 0) {
                data.events.forEach(event => {
                    const li = document.createElement('li');
                    const date = new Date(event.start);
                    li.innerHTML = `
                        <strong>${event.summary}</strong><br>
                        ${date.toLocaleString()}
                    `;
                    eventsList.appendChild(li);
                });
            } else {
                eventsList.innerHTML = '<li>No hay eventos próximos</li>';
            }
        })
        .catch(error => {
            console.error('Error en la solicitud:', error); // Debug
            eventsList.innerHTML = `
                <li>Error al cargar los eventos</li>
                <button onclick="window.location.href='/autorizar'">
                    Conectar con Google Calendar
                </button>
            `;
        });
}

// Llamar a la función cuando se carga la página
document.addEventListener('DOMContentLoaded', loadCalendarEvents);
</script>
</body>
</html>