<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Zona Alimentación</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/pagina.css') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <script src="{{ url_for('static', filename='js/script.js') }}" defer></script>

  <style>
    /* ================= Estilos específicos de Alimentación ================= */
    body {
      margin: 0;
      font-family: 'Roboto', sans-serif;
      background: linear-gradient(180deg, #001a33 0%, #002838 40%, #002f2f 100%);
      color: #fff;
      scroll-behavior: smooth;
    }
    
    .titulo-seccion {
      background-color: #001a33;
      color: white;
      padding: 1.5rem 2rem;
      margin-top: 80px; /* Se aumentó de 60px a 100px */
      border-bottom: 1px solid rgba(255,255,255,0.1);
      margin-bottom: 40px;
    }
    
    .titulo-seccion h1 {
      margin: 0;
      font-size: 2rem;
    }
    
    .titulo-seccion p {
      margin: 0.5rem 0 0 0;
      color: #bbbbbb;
      font-size: 1rem;
    }
    
    .main-content {
      padding: 0 40px 40px;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .macro-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }
    
    .macro-card {
      background: white;
      color: #333;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
      text-align: center;
    }
    
    .macro-card h3 {
      color: #58a058;
      margin-top: 0;
    }
    
    .recipes-section {
      background: white;
      color: #333;
      border-radius: 8px;
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
    }
    
    .recipes-section h2 {
      color: #58a058;
      margin-top: 0;
    }
    
    .recipe-list {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    
    .recipe-card {
      display: flex;
      gap: 20px;
      background: #f7f9fa;
      border-radius: 8px;
      overflow: hidden;
    }
    
    .recipe-card img {
      width: 120px;
      height: 120px;
      object-fit: cover;
    }
    
    .recipe-card div {
      padding: 15px 15px 15px 0;
    }
    
    .recipe-card h3 {
      margin: 0 0 10px 0;
      color: #333;
    }
    
    .recipe-card p {
      margin: 0;
      color: #666;
    }
    
    #google-calendar-container {
      background: white;
      color: #333;
      border-radius: 8px;
      padding: 30px;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
    }
    
    #google-calendar-container h2 {
      color: #58a058;
      margin-top: 0;
    }
    
    #events-list {
      list-style: none;
      padding: 0;
    }
    
    #events-list li {
      background: #f7f9fa;
      margin-bottom: 10px;
      padding: 15px;
      border-radius: 6px;
      border: 1px solid #e0e0e0;
    }
    
    #events-list li strong {
      color: #333;
    }
    
    #events-list li button {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 10px;
    }
    
    /* Responsive Styles */
    @media (max-width: 768px) {
      .main-content {
        padding: 0 20px 20px;
      }
      
      .recipe-card {
        flex-direction: column;
      }
      
      .recipe-card img {
        width: 100%;
        height: 180px;
      }
      
      .recipe-card div {
        padding: 15px;
      }
    }

    /* Estilos para el calendario */
    #calendar-container {
      margin-top: 40px;
      text-align: center;
    }
    #calendar-controls {
      margin-bottom: 10px;
    }
    #calendar-controls button {
      background-color: #007bff;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 4px;
      cursor: pointer;
      margin: 0 5px;
      transition: transform 0.1s ease-in-out, background-color 0.2s ease;
    }
    #calendar-controls button:hover {
      background-color: #005bb5;
    }
    #calendar-controls button:active {
      transform: scale(0.95);
    }
    .calendar-table {
      width: 100%;
      border-collapse: collapse;
      margin: 0 auto;
    }
    .calendar-table th, .calendar-table td {
      border: 1px solid #ddd;
      padding: 10px;
      width: 14.28%;
      text-align: center;
    }
    .other-month {
      color: #aaa;
    }
    .event-day {
      background-color: #58a058;
      color: white;
    }
  </style>
</head>
<body>
  {% include 'partials/header.html' %}

<!-- CONTENIDO PRINCIPAL -->
<div class="titulo-seccion">
  <h1>Zona Alimentación</h1>
  <p>Organiza tus menús, aprende sobre nutrición y recibe recomendaciones personalizadas.</p>
</div>
<div class="main-content">
  <!-- HERO BANNER y tarjetas de macronutrientes -->
  <div class="macro-cards">
    <div class="macro-card">
      <h3>Proteínas</h3>
      <p>Base para la construcción de músculo y regeneración de tejidos. Prioriza fuentes magras.</p>
    </div>
    <div class="macro-card">
      <h3>Carbohidratos</h3>
      <p>La principal fuente de energía. Incluye cereales integrales y frutas en tu dieta.</p>
    </div>
    <div class="macro-card">
      <h3>Grasas</h3>
      <p>Esenciales para funciones hormonales. Elige grasas saludables como aguacate o aceite de oliva.</p>
    </div>
  </div>

  <!-- Sección de recetas -->
  <div class="recipes-section">
    <h2><i class="fas fa-utensils"></i> Recetas Destacadas</h2>
    <div class="recipe-list">
      <div class="recipe-card">
        <img src="https://picsum.photos/600/400?random=500" alt="Receta 1">
        <div>
          <h3>Ensalada</h3>
          <p>Hojas verdes, pollo a la plancha y frutos secos. Perfecta para un almuerzo ligero.</p>
        </div>
      </div>
      <div class="recipe-card">
        <img src="https://picsum.photos/600/400?random=501" alt="Receta 2">
        <div>
          <h3>Smoothie de Proteína</h3>
          <p>Combina frutas, leche vegetal y tu proteína favorita para un desayuno rápido.</p>
        </div>
      </div>
      <div class="recipe-card">
        <img src="https://picsum.photos/600/400?random=502" alt="Receta 3">
        <div>
          <h3>Salteado de Verduras</h3>
          <p>Brócoli, zanahoria y pimientos con salsa ligera. Alto en vitaminas.</p>
        </div>
      </div>
    </div>
  </div>

  <p style="line-height:1.6; margin-bottom:30px;">
    Ajusta tus comidas según tus objetivos y deja que nuestra IA te sugiera planes semanales equilibrados. Explora más recetas y tips para convertir tu alimentación en un pilar de tu salud.
  </p>

  <!-- Nueva sección de calendario -->
  <div id="calendar-container">
    <div id="calendar-controls">
      <button id="prev-month">&laquo; Anterior</button>
      <button id="next-month">Siguiente &raquo;</button>
      <button id="load-events-google">Mostrar eventos Google</button>
    </div>
    <div id="calendar">
      <!-- Se renderizará el calendario aquí -->
    </div>
  </div>
</div>

<script>
// Usar el mes actual y variable global para conservar los eventos
let currentDate = new Date();
let loadedEvents = null; // <-- Variable para conservar los eventos

function renderCalendar(date, events = []) {
  const calendarDiv = document.getElementById('calendar');
  calendarDiv.innerHTML = '';
  
  const monthNames = ['Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'];
  const header = document.createElement('h2');
  header.textContent = monthNames[date.getMonth()] + ' ' + date.getFullYear();
  calendarDiv.appendChild(header);
  
  const table = document.createElement('table');
  table.className = 'calendar-table';
  
  // Cabezera con días
  const thead = document.createElement('thead');
  const trHead = document.createElement('tr');
  ['Dom','Lun','Mar','Mié','Jue','Vie','Sáb'].forEach(day => {
      const th = document.createElement('th');
      th.textContent = day;
      trHead.appendChild(th);
  });
  thead.appendChild(trHead);
  table.appendChild(thead);
  
  const tbody = document.createElement('tbody');
  const firstDay = new Date(date.getFullYear(), date.getMonth(), 1);
  const lastDay = new Date(date.getFullYear(), date.getMonth() + 1, 0);
  
  let row = document.createElement('tr');
  // Insertar celdas en blanco hasta el primer día
  for(let i = 0; i < firstDay.getDay(); i++){
      const blankCell = document.createElement('td');
      row.appendChild(blankCell);
  }
  
  // Rellenar los días del mes
  for(let day = 1; day <= lastDay.getDate(); day++){
      if(row.children.length === 7){
          tbody.appendChild(row);
          row = document.createElement('tr');
      }
      const cell = document.createElement('td');
      const cellDate = new Date(date.getFullYear(), date.getMonth(), day);
      cell.textContent = day;
      // Agregar atributo con fecha en formato ISO (yyyy-mm-dd)
      cell.setAttribute('data-date', cellDate.toISOString().slice(0,10));
      row.appendChild(cell);
  }
  // Completar la última fila con celdas vacías si es necesario
  while(row.children.length < 7){
      const blankCell = document.createElement('td');
      row.appendChild(blankCell);
  }
  tbody.appendChild(row);
  table.appendChild(tbody);
  calendarDiv.appendChild(table);
  
  // Marcar eventos en el día correspondiente
  events.forEach(ev => {
      const evDate = new Date(ev.start).toISOString().slice(0,10);
      const cell = calendarDiv.querySelector(`td[data-date="${evDate}"]`);
      if(cell){
          const evDiv = document.createElement('div');
          evDiv.className = 'event-item';
          evDiv.style.fontSize = '0.7rem';
          evDiv.style.backgroundColor = '#58a058';
          evDiv.style.color = '#fff';
          evDiv.style.marginTop = '5px';
          evDiv.textContent = ev.summary;
          cell.appendChild(evDiv);
      }
  });
}

function loadGoogleEvents() {
  fetch('/api/calendar/events')
    .then(response => response.json())
    .then(data => {
      if(data.status === "success" && data.events) {
         loadedEvents = data.events; // Guardar eventos cargados
      } else {
         loadedEvents = [];
      }
      renderCalendar(currentDate, loadedEvents);
    })
    .catch(error => {
      console.error("Error al cargar eventos:", error);
      loadedEvents = [];
      renderCalendar(currentDate, loadedEvents);
    });
}

function fetchAndRenderCalendar() {
  // Si existen eventos cargados, se usan, sino se renderiza sin eventos.
  renderCalendar(currentDate, loadedEvents || []);
}

document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('prev-month').addEventListener('click', () => {
    currentDate = new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1);
    fetchAndRenderCalendar();
  });
  document.getElementById('next-month').addEventListener('click', () => {
    currentDate = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 1);
    fetchAndRenderCalendar();
  });
  document.getElementById('load-events-google').addEventListener('click', () => {
    loadGoogleEvents();
  });
  fetchAndRenderCalendar();
});
</script>
</body>
</html>